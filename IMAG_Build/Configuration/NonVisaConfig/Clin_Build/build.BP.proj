<?xml version="1.0" encoding="utf-8"?><Project ToolsVersion="4.0" DefaultTargets="Publish" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">	<PropertyGroup>			<!-- Input parameters -->		<PatchNumber></PatchNumber>		<TestNumber></TestNumber>		<SequenceNumber></SequenceNumber>		<CodeBaseDir></CodeBaseDir>		<StageToSQA></StageToSQA>			<ProjectName>BP</ProjectName>		<TempFolder>\temp</TempFolder>				<BuildCompressed>true</BuildCompressed>		<CreateMsi>False</CreateMsi>		<CreateExe>True</CreateExe>										<PaddedPatchNumber>$(PatchNumber)</PaddedPatchNumber>		<PaddedPatchNumber Condition="$(PatchNumber) &lt; 100">0$(PatchNumber)</PaddedPatchNumber>		<PaddedPatchNumber Condition="$(PatchNumber) &lt; 10">00$(PatchNumber)</PaddedPatchNumber>		<!-- PatchFolderName>V3.0p$(PaddedPatchNumber)Sequence$(SequenceNumber)</PatchFolderName -->		<PatchFolderName>P$(PatchNumber)-T$(TestNumber)-S$(SequenceNumber)</PatchFolderName>				<ProductVersion Condition="'$(ProductVersionInclude)'!='false'">30.$(SequenceNumber).$(PatchNumber).$(TestNumber)</ProductVersion>		<NonVisaCfgDir>$(CodeBaseDir)\IMAG_Build\Configuration\NonVisaConfig</NonVisaCfgDir>		<ClinicalDir>$(CodeBaseDir)\IMAG_Source\Clinical</ClinicalDir>			<ToolsDir>$(CodeBaseDir)\IMAG_Build\Tools</ToolsDir>		<ReleaseClinDir>$(CodeBaseDir)\IMAG_Build\Release\Clin</ReleaseClinDir>		<ApplicationSrcDir>$(CodeBaseDir)\IMAG_Source\Clinical\Delphi\Applications</ApplicationSrcDir>						<P72LibHome>$(CodeBaseDir)\IMAG_Build\LegacyVSS\GW\3rd Party Source\Accusoft\Accusoft15</P72LibHome>		<P106LibHome>$(CodeBaseDir)\IMAG_Build\LegacyVSS\GW\3rd Party Source\Accusoft\Accusoft16.2</P106LibHome> 					<!-- Specfic defined parameters for Build-4 server -->		<BDK32Dir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\Vista\BDK32</BDK32Dir>		<AccuSoftDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\AccuSoft\ImageGear v16</AccuSoftDir>		<AccuSoftPackageDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\AccuSoft\ImageGear v16\MD\ActiveX\Samples\Delphi2007\Package</AccuSoftPackageDir>				<DelphiFilmanexDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Documents and Settings\All Users\Documents\RAD Studio\5.0\Demos\DelphiWin32\VCLWin32\Doc\Filmanex</DelphiFilmanexDir>			<VCLZip_Pro Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\VCLZip_Pro</VCLZip_Pro>										<MSBuildInstallShieldDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\MSBuild\InstallShield\2012Spring</MSBuildInstallShieldDir>		<NetworkBuildDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">\\W2k8-stvi-sqa\Release\ReadyToTest\Patch$(PatchNumber)</NetworkBuildDir>				<DependedPatches Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">\SomeFolder\SomeDir\Release\Clin</DependedPatches>		<Delphi2007 Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\CodeGear\RAD Studio\5.0</Delphi2007>		<FMDC Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files (x86)\Vista\FMDC</FMDC>					<Delphi7Dir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files\Borland\Delphi7</Delphi7Dir>				<!-- Parameter for build.VistAImaging.xml -->		<InstallShieldPath Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\InstallShield\2012Spring\System</InstallShieldPath>						<!-- ================================================= -->									<!-- Specfic defined parameters for Build-5 server -->		<BDK32Dir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\Vista\BDK32</BDK32Dir>						<AccuSoftDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\AccuSoft\ImageGear v16</AccuSoftDir>		<AccuSoftPackageDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\AccuSoft\ImageGear v16\MD\ActiveX\Samples\Delphi2007\Package</AccuSoftPackageDir>								<DelphiFilmanexDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Users\Public\Documents\RAD Studio\5.0\Demos\DelphiWin32\VCLWin32\Doc\Filmanex</DelphiFilmanexDir>			<VCLZip_Pro Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">E:\BuildLib\VCLZip_Pro_4.60</VCLZip_Pro>								<MSBuildInstallShieldDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\MSBuild\InstallShield\2012Spring</MSBuildInstallShieldDir>		<NetworkBuildDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">\\vaausvimapp804.aac.dva.va.gov\CM\ReadyToTest\Patch$(PatchNumber)</NetworkBuildDir>		<DependedPatches Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">E:\Workspace\Depended_Patches</DependedPatches>		<Delphi2007 Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\CodeGear\RAD Studio\5.0</Delphi2007>		<FMDC Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\Vista\FMDC</FMDC>									<Delphi7Dir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">E:\BuildLib\Delphi7</Delphi7Dir>				<MSBuildExtensionsPath Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">$(MSBuildExtensionsPath64)</MSBuildExtensionsPath>							<!-- Parameter for build.VistAImaging.xml -->		<InstallShieldPath Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\InstallShield\2012Spring\System</InstallShieldPath>		<!-- ================================================= -->				<BuildDir>$(CodeBaseDir)\Builds</BuildDir>					<OutputDir>$(BuildDir)\$(ProjectName)</OutputDir>		<FullBuildPath>$(OutputDir)\$(PatchFolderName)</FullBuildPath>		<ExeFile>$(FullBuildPath)\MAG3_0P$(PatchNumber)T$(TestNumber)_BP_Setup.exe</ExeFile>						<!-- Parameter for build.VistAImaging.xml -->						<InstallShieldProject>$(FullBuildPath)$(TempFolder)\P$(PatchNumber)\InstallShield\MagBPSetup.ism</InstallShieldProject>													</PropertyGroup>			<!-- ==============================================================================  -->	<Import Project="$(MSBuildInstallShieldDir)\InstallShield.targets"/>	<Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/> 			<Import Project="$(NonVisaCfgDir)\Common\build.VistAImaging.xml"/>				<Import Project="$(ClinicalDir)\Delphi\Applications\Build\$(ProjectName)\build.$(ProjectName).prop"/>		<!-- ==============================================================================  -->				<ItemGroup>		<ResVerEditorDir Include="$(ToolsDir)\ResVerEditor" />			<GWUtilitiesDir Include="$(ToolsDir)\ChangeRes" />			<P72Lib Include="$(P72LibHome)\**\*.*" />		<P106LibSystem Include="$(P106LibHome)\System\**\*.*" />		<P106Lib Include="$(P106LibHome)\**\*.*" />					</ItemGroup>		<!-- =============================================================================== -->	<!-- =============================================================================== -->	<Target Name="CleanPreviousBuild">				<message text="Executing CleanPreviousBuild ..." Importance="High"/>		<RemoveDir Directories="$(FullBuildPath)" Condition="Exists('$(FullBuildPath)')" />			</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->	<Target Name="CreateDirectories" DependsOnTargets="CleanPreviousBuild" >						<message text="Executing CreateDirectories ..." Importance="High" />		<MakeDir directories="$(OutputDir)" Condition="!Exists('$(OutputDir)')" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)"  />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\dcu" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu" />				<!--					<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\BMP"  />			<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\CLin\Import_OCX"  />				<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\Shared"  />				<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\Diagram Annotation\MagAnnTool"  />				<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\dcu"  />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\InstallShield"  />				<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\BP Queue Processor Source" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\BP Purge Source" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\BP Verifier Source" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Import" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\BP Queue Processor Source\Help" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\BP Verifier Source\Help" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu" />		-->	</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->	<!-- Copy files from source control over to build output directory -->	<Target Name="CopyFiles"  DependsOnTargets="CreateDirectories" >				<message text="Executing CopyFiles ..." Importance="High"/>		<ItemGroup>			<SccFiles Include="$(FullBuildPath)$(TempFolder)\**\*.scc" />		</ItemGroup>			<Copy SourceFiles="@(PatchDepName)" DestinationFiles="@(PatchDepName->'$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\%(Folder)\%(RecursiveDir)%(Filename)%(Extension)')" ContinueOnError="True"/>		<Copy SourceFiles="@(P72Lib)" DestinationFiles="@(P72Lib->'$(FullBuildPath)$(TempFolder)\P72 Lib\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(P106LibSystem)" DestinationFiles="@(P106LibSystem->'$(FullBuildPath)$(TempFolder)\P106Lib\System\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(P106Lib)" DestinationFiles="@(P106Lib->'$(FullBuildPath)$(TempFolder)\P106Lib\LIB\Accusoft16.2\%(RecursiveDir)%(Filename)%(Extension)')" />					<Delete Files="@(SccFiles)" />	</Target>	<!-- =============================================================================== -->	<!-- =============================================================================== -->	<Target Name="UpdateVersion" DependsOnTargets="CopyFiles" Outputs="%(DelphiFiles.Identity)">				<message text="Executing UpdateVersion ..." Importance="High"/>		<PropertyGroup>				<GWDir>%(GWUtilitiesDir.FullPath)</GWDir>			<ResDir>%(ResVerEditorDir.FullPath)</ResDir>		</PropertyGroup>			<message text="Updating File Version number for %(DelphiFiles.Resource)" Importance="High"/>		<Exec Condition="'%(DelphiFiles.Compiler)'=='MSBuild'" Command='"$(ResDir)\ResVerEditor.exe" -u %(DelphiFiles.Resource) $(ProductVersion))' WorkingDirectory="%(DelphiFiles.Identity)" ContinueOnError="false" />		<Exec Condition="'%(DelphiFiles.Compiler)'=='Delphi2007'" Command='"$(GWDir)\ChangeRes.exe" %(DelphiFiles.Resource) -U [VERSIONINFO] FileVersion=$(ProductVersion)/s' WorkingDirectory="%(DelphiFiles.Identity)" ContinueOnError="false" />			</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->	<!-- Compile Delphi projects -->	<Target Name="Compile" DependsOnTargets="UpdateVersion" Outputs="%(DelphiFiles.Identity)">		<message text="Executing Compile ..." Importance="High"/>		<message text="Compiling %(DelphiFiles.Filename)%(DelphiFiles.Extension) with compiler %(DelphiFiles.Compiler)" Importance="High"/>		<MSBuild Projects="%(DelphiFiles.RelativeDir)%(DelphiFiles.Project)" Targets="%(DelphiFiles.Options)" Properties="Configuration=%(DelphiFiles.Configuration)" Condition="'%(DelphiFiles.Compiler)'=='MSBuild'AND '%(DelphiFiles.ProjectOverride)'!='true'" /> 		<MSBuild Projects="%(DelphiFiles.RelativeDir)%(DelphiFiles.Project)"			Condition="'%(DelphiFiles.Compiler)'=='MSBuild' AND '%(DelphiFiles.ProjectOverride)'=='true'"			Targets="%(DelphiFiles.Options)" 			Properties="Configuration=%(DelphiFiles.Configuration);						DCC_DcuOutput=%(DelphiFiles.DCC_DcuOutput);						DCC_ObjOutput=%(DelphiFiles.DCC_ObjOutput);						DCC_HppOutput=%(DelphiFiles.DCC_HppOutput);												DCC_UnitSearchPath=%(DelphiFiles.DCC_UnitSearchPath);						DCC_ResourcePath=%(DelphiFiles.DCC_ResourcePath);						DCC_ObjPath=%(DelphiFiles.DCC_ObjPath);						DCC_IncludePath=%(DelphiFiles.DCC_IncludePath);						DCC_Define=%(DelphiFiles.DCC_Define);							DCC_ExeOutput=%(DelphiFiles.DCC_ExeOutput)" />											<Exec Condition="'%(DelphiFiles.Compiler)'=='Delphi2007'" Command='"$(Delphi2007)\bin\Dcc32.exe" -B %(DelphiFiles.Project) -Q -N"$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu" -U"$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu;$(Delphi2007)\Lib\Indy10;$(Delphi2007)\Imports;$(Delphi7Dir)\Lib;$(Delphi7Dir)\Source\Rtl\Sys;$(BDK32Dir)\D2007;$(BDK32Dir)\Source;$(FMDC)\Source;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\Import;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\dcu;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\Import_OCX" -I"$(Delphi2007)\Imports"' WorkingDirectory="%(DelphiFiles.Identity)" ContinueOnError="false" />		<!-- Exec Condition="'%(DelphiFiles.Compiler)'=='Delphi2007'" Command='"$(Delphi2007)\bin\Dcc32.exe" -B %(DelphiFiles.Project) -Q -N"$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu" -U"$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu;$(Delphi2007)\Lib\Indy10;$(Delphi2007)\Imports;$(Delphi7Dir)\Lib;$(BDK32Dir)\D2007;$(BDK32Dir)\Source;$(FMDC)\Source;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\dcu;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\Import_OCX" -I"$(Delphi2007)\Imports"' WorkingDirectory="%(DelphiFiles.Identity)" ContinueOnError="false" / -->   									</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->			<!-- Generate Product and Package code for InstallShield -->		<Target Name="UpdateISM" DependsOnTargets="Compile" >				<message text="Executing UpdateISM ..." Importance="High"/>		<CallTarget Targets="GenerateProductCode" />	<!-- from ...\Common\buil.VistAImaging.xml -->		<CallTarget Targets="GeneratePackageCode" />	<!-- from ...\Common\buil.VistAImaging.xml -->			</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="BuildRelease" DependsOnTargets="UpdateISM" >				<message text="Executing BuildRelease ..." Importance="High"/>		<CallTarget Targets="CreateInstaller" />	<!-- from ...\Common\buil.VistAImaging.xml -->			</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="StageToSQA" >					<MakeDir Directories="$(NetworkBuildDir)" Condition="!Exists('$(NetworkBuildDir)')" />		<Delete Files="$(ExeFile)" Condition="!Exists('$(ExeFile)')" />		<Copy SourceFiles="$(ExeFile)" Destinationfolder="$(NetworkBuildDir)"/>			</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Clean up final build directory ================== -->	<Target Name="Publish" DependsOnTargets="BuildRelease" >				<message text="Executing Publish ..." Importance="High"/>		<Copy SourceFiles="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\InstallShield\MAGBPSetup\PROJECT_ASSISTANT\%(InstallShieldReleaseConfiguration.Identity)\DiskImages\DISK1\setup.exe" DestinationFiles="$(FullBuildPath)\$(ExeFile)" Condition="'$(CreateExe)'!='False'" />				<CallTarget Targets="StageToSQA"  Condition="'$(StageToSQA)'=='True'" />		    </Target>   	<!-- =============================================================================== -->	<!-- =============================================================================== -->	<Target Name="TEST" DependsOnTargets="UpdateVersion" Outputs="%(DelphiFiles.Identity)" >		<message text="Executing Test ..." Importance="High"/>				<message text="Executing Compile ..." Importance="High"/>		<message text="Compiling %(DelphiFiles.Filename)%(DelphiFiles.Extension) with compiler %(DelphiFiles.Compiler)" Importance="High"/>				<MSBuild Projects="%(DelphiFiles.RelativeDir)%(DelphiFiles.Project)" Targets="%(DelphiFiles.Options)" Properties="Configuration=%(DelphiFiles.Configuration)" Condition="'%(DelphiFiles.Compiler)'=='MSBuild'AND '%(DelphiFiles.ProjectOverride)'!='true'" /> 		<MSBuild Projects="%(DelphiFiles.RelativeDir)%(DelphiFiles.Project)"			Condition="'%(DelphiFiles.Compiler)'=='MSBuild' AND '%(DelphiFiles.ProjectOverride)'=='true'"			Targets="%(DelphiFiles.Options)" 			Properties="Configuration=%(DelphiFiles.Configuration);						DCC_DcuOutput=%(DelphiFiles.DCC_DcuOutput);						DCC_ObjOutput=%(DelphiFiles.DCC_ObjOutput);						DCC_HppOutput=%(DelphiFiles.DCC_HppOutput);												DCC_UnitSearchPath=%(DelphiFiles.DCC_UnitSearchPath);						DCC_ResourcePath=%(DelphiFiles.DCC_ResourcePath);						DCC_ObjPath=%(DelphiFiles.DCC_ObjPath);						DCC_IncludePath=%(DelphiFiles.DCC_IncludePath);						DCC_Define=%(DelphiFiles.DCC_Define);							DCC_ExeOutput=%(DelphiFiles.DCC_ExeOutput)" />											<Exec Condition="'%(DelphiFiles.Compiler)'=='Delphi2007'" Command='"$(Delphi2007)\bin\Dcc32.exe" -B %(DelphiFiles.Project) -Q -N"$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu" -U"$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\dcu;$(Delphi2007)\Imports;$(BDK32Dir)\D2007;$(BDK32Dir)\Source;$(FMDC)\Source;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Background Processor\Import;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\dcu;$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\Import_OCX" -I"$(Delphi2007)\Imports"' WorkingDirectory="%(DelphiFiles.Identity)" ContinueOnError="false" />								</Target>		</Project>