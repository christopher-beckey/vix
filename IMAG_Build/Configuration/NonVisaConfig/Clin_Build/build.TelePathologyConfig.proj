<?xml version="1.0" encoding="utf-8"?><Project ToolsVersion="4.0" DefaultTargets="Publish" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">			<PropertyGroup>						<!-- Input parameters -->		<PatchNumber></PatchNumber>		<TestNumber></TestNumber>		<SequenceNumber></SequenceNumber>		<CodeBaseDir></CodeBaseDir>		<StageToSQA></StageToSQA>			<ReleaseName>TelePathologyConfigurator</ReleaseName>					<ProjectName>TelePathologyConfig</ProjectName>		<TempFolder>\temp</TempFolder>				<BuildCompressed>true</BuildCompressed>										<NonVisaCfgDir>$(CodeBaseDir)\IMAG_Build\Configuration\NonVisaConfig</NonVisaCfgDir>		<ClinicalDir>$(CodeBaseDir)\IMAG_Source\Clinical</ClinicalDir>					<PaddedPatchNumber>$(PatchNumber)</PaddedPatchNumber>		<PaddedPatchNumber Condition="$(PatchNumber) &lt; 100">0$(PatchNumber)</PaddedPatchNumber>		<PaddedPatchNumber Condition="$(PatchNumber) &lt; 10">00$(PatchNumber)</PaddedPatchNumber>		<!-- PatchFolderName>V3.0p$(PaddedPatchNumber)Sequence$(SequenceNumber)</PatchFolderName -->		<PatchFolderName>P$(PatchNumber)-T$(TestNumber)-S$(SequenceNumber)</PatchFolderName>						<ReleaseDir>$(CodeBaseDir)\Release</ReleaseDir>		<BuildDir>$(CodeBaseDir)\Builds</BuildDir>				<OutputDir>$(BuildDir)\$(ProjectName)</OutputDir>			<FullBuildPath>$(OutputDir)\$(PatchFolderName)</FullBuildPath>					<InstallShieldProject>$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\MagTelePathologyConfig.ism</InstallShieldProject>				<ExeFileName>MAG3_0P$(PatchNumber)T$(TestNumber)_$(ReleaseName)_Setup.exe</ExeFileName>		<!-- Specfic defined parameters for Build-4 server -->		<MSBuildInstallShieldDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\MSBuild\InstallShield\2012Spring</MSBuildInstallShieldDir>		<InstallShieldPath Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\InstallShield\2012Spring\System</InstallShieldPath>				<NetworkBuildDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">\\W2k8-stvi-sqa\Release\ReadyToTest\Patch$(PatchNumber)</NetworkBuildDir>			<!-- ================================================= -->									<!-- Specfic defined parameters for Build-5 server -->						<MSBuildInstallShieldDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\MSBuild\InstallShield\2012Spring</MSBuildInstallShieldDir>		<InstallShieldPath Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\InstallShield\2012Spring\System</InstallShieldPath>		<NetworkBuildDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">\\vaausvimapp804.aac.dva.va.gov\CM\ReadyToTest\Patch$(PatchNumber)</NetworkBuildDir>					<MSBuildExtensionsPath Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">$(MSBuildExtensionsPath64)</MSBuildExtensionsPath>			<!-- ================================================= -->					</PropertyGroup>		<!-- ============================================================================  -->		<Import Project="$(MSBuildInstallShieldDir)\InstallShield.targets" />		<Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>	<Import Project="$(MSBuildExtensionsPath)\ExtensionPack\4.0\MSBuild.ExtensionPack.tasks" /> 	<Import Project="$(NonVisaCfgDir)\Common\build.VistAImaging.xml"/>			<Import Project="$(ClinicalDir)\DotNet\TelePathology\build.$(ProjectName).prop"/>	<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Delete previous build -->	<Target Name="CleanPreviousBuild" >		<RemoveDir Directories="$(FullBuildPath)" Condition="Exists('$(FullBuildPath)')" />		<RemoveDir Directories="$(ReleaseDir)" Condition="Exists('$(ReleaseDir)')" /> 		</Target>	<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Create build ouput directories -->	<Target Name="CreateDirectories" DependsOnTargets="CleanPreviousBuild" >		<MakeDir directories="$(FullBuildPath)$(TempFolder)" />	</Target>	<!-- =============================================================================== -->	<!-- =============================================================================== -->				<!-- Copy files from source control over to build output directory -->	<Target Name="CopyFiles"  DependsOnTargets="CreateDirectories" >		<Copy SourceFiles="@(PatchDepName)" DestinationFiles="@(PatchDepName->'$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\%(RecursiveDir)%(Filename)%(Extension)')" />	</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="UpdateAssembly" DependsOnTargets="CopyFiles" >			<PropertyGroup>			<Major>3</Major>			<Minor>0</Minor>			<Build>$(PatchNumber)</Build>			<Revision>$(TestNumber)</Revision>		</PropertyGroup>				<MSBuild.ExtensionPack.Framework.AssemblyInfo					AssemblyMajorVersion="$(Major)" 			AssemblyMinorVersion="$(Minor)"             AssemblyBuildNumber="$(Revision)"            AssemblyRevision="$(Revision)"                           AssemblyFileMajorVersion="$(Major)" 			AssemblyFileMinorVersion="$(Minor)"			AssemblyFileBuildNumber="$(Build)" 			AssemblyFileRevision="$(Revision)" 			 			AssemblyInfoFiles="%(ProjectProperties.Identity)\AssemblyInfo.cs"			AssemblyProduct="%(ProjectProperties.ProductName)"			AssemblyCompany="Department of Veterans Affairs"            AssemblyTitle="%(ProjectProperties.ProductName)"			AssemblyVersion="$(Major).$(Minor).$(Build).$(Revision)"            AssemblyFileVersion="$(Major).$(Minor).$(Build).$(Revision)" />		           	</Target>					<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Compile .Net projects -->	<Target Name="Compile_NotNOW" DependsOnTargets="UpdateAssembly" Outputs="%(CompileFiles.Identity)">		<message text="Compiling %(CompileFiles.Filename)%(CompileFiles.Extension) with compiler %(CompileFiles.Compiler)" Importance="High"/>				<MSBuild Projects="@(CompileFiles)" Targets="%(CompileFiles.Options)" Properties="Configuration=$(CompileFiles.Configuration);Platform=%(CompileFiles.Platform);SolutionDir=$(SolutionDir)"  Condition="'%(CompileFiles.Compiler)'=='MSBuild'" /> 	</Target>		<!-- ================== Compile .Net projects ================================================== -->	<Target Name="Compile" DependsOnTargets="UpdateAssembly" >		<MSBuild Projects="%(CompileFiles.Identity)" Properties="Configuration=$(Configuration);SolutionDir=$(SolutionDir)"  /> 	</Target>				<!-- =============================================================================== -->	<!-- =============================================================================== -->	<!-- Generate new InstallShield product code -->	<Target Name="UpdateISM" DependsOnTargets="Compile" >		<CallTarget Targets="GenerateProductCode" />	<!-- from ...\Common\buil.VistAImaging.xml -->		<CallTarget Targets="GeneratePackageCode" />	<!-- from ...\Common\buil.VistAImaging.xml -->	</Target>	<!-- =============================================================================== -->	<!-- =============================================================================== -->			<!-- Copy artifacts to release folder  -->	<Target Name="Copy_Artifacts" DependsOnTargets="UpdateISM" >		<ItemGroup>			<Artifacts Include="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Bapi32_47_1.dll; 								$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\CCOWRPCBroker.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\GalaSoft.MvvmLight.Extras.WPF4.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\GalaSoft.MvvmLight.WPF4.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\log4net.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Microsoft.Practices.ServiceLocation.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\RestSharp.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\System.Windows.Interactivity.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VergenceContextor.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VergenceContextor.sxs.manifest;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Common.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Communication.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Logging.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\MagTPConfigurator.exe;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\MagTPConfigurator.exe.config" />		</ItemGroup>		<Copy SourceFiles="@(Artifacts)" DestinationFolder="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Artifacts" ContinueOnError="false" />		</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Create InstallShield Installer -->	<Target Name="BuildRelease" DependsOnTargets="Copy_Artifacts" >			<CallTarget Targets="CreateInstaller" />			<!-- from ...\Common\buil.VistAImaging.xml -->	</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="StageToSQA" >					<MakeDir Directories="$(NetworkBuildDir)" Condition="!Exists('$(NetworkBuildDir)')" />						<Delete Files="$(NetworkBuildDir)\$(ExeFileName)" Condition="!Exists('$(NetworkBuildDir)\$(ExeFileName)')" />		<Copy SourceFiles="$(FullBuildPath)\$(ExeFileName)" Destinationfolder="$(NetworkBuildDir)"/>				</Target>				<!-- =============================================================================== -->	<!-- =============================================================================== -->			<Target Name="Publish" DependsOnTargets="BuildRelease" Condition="'$(BuildTelePathologyConfig)'!='false'"  >				<Copy SourceFiles="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\MagTelePathologyConfig\PROJECT_ASSISTANT\SINGLE_EXE_IMAGE\DiskImages\DISK1\setup.exe" DestinationFiles="$(FullBuildPath)\$(ExeFileName)" Condition="'$(CreateExe)'!='false'"/>			 		<CallTarget Targets="StageToSQA"  Condition="'$(StageToSQA)'=='True'" /> 			</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->			<Target Name="TestCompile" Outputs="%(CompileFiles.Identity)">		<message text="Compiling %(CompileFiles.Filename)%(CompileFiles.Extension) with compiler %(CompileFiles.Compiler)" Importance="High"/>				<MSBuild Projects="@(CompileFiles)" Targets="%(CompileFiles.Options)" Properties="Configuration=$(CompileFiles.Configuration);Platform=%(CompileFiles.Platform);SolutionDir=$(SolutionDir)"  Condition="'%(CompileFiles.Compiler)'=='MSBuild'" /> 	</Target>			</Project>