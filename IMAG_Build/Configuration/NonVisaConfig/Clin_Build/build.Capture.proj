<?xml version="1.0" encoding="utf-8"?><Project ToolsVersion="4.0" DefaultTargets="Publish" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">	<PropertyGroup>				<!-- Input parameters -->		<PatchNumber></PatchNumber>		<TestNumber></TestNumber>		<SequenceNumber></SequenceNumber>		<CodeBaseDir></CodeBaseDir>		<StageToSQA></StageToSQA>			<ProjectName>Capture</ProjectName>		<TempFolder>\temp</TempFolder>				<!-- BuildCompressed>true</BuildCompressed -->					<PaddedPatchNumber>$(PatchNumber)</PaddedPatchNumber>		<PaddedPatchNumber Condition="$(PatchNumber) &lt; 100">0$(PatchNumber)</PaddedPatchNumber>		<PaddedPatchNumber Condition="$(PatchNumber) &lt; 10">00$(PatchNumber)</PaddedPatchNumber>		<!-- PatchFolderName>V3.0p$(PaddedPatchNumber)Sequence$(SequenceNumber)</PatchFolderName -->		<PatchFolderName>P$(PatchNumber)-T$(TestNumber)-S$(SequenceNumber)</PatchFolderName>					<ReleaseDir>$(CodeBaseDir)\Release</ReleaseDir>		<BuildDir>$(CodeBaseDir)\Builds</BuildDir>				<OutputDir>$(BuildDir)\$(ProjectName)</OutputDir>			<FullBuildPath>$(OutputDir)\$(PatchFolderName)</FullBuildPath>						<!-- Specfic defined parameters for Build-4 server -->		<BDK32Dir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\Vista\BDK32</BDK32Dir>					<DelphiDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\CodeGear\RAD Studio\5.0</DelphiDir>		<DelphiVA508Dir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\CodeGear\RAD Studio\5.0\Imports\VA508Access</DelphiVA508Dir>				<DelphiFilmanexDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Documents and Settings\All Users\Documents\RAD Studio\5.0\Demos\DelphiWin32\VCLWin32\Doc\Filmanex</DelphiFilmanexDir>			<AccuSoftDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\AccuSoft\ImageGear v16</AccuSoftDir>		<AccuSoftPackageDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\AccuSoft\ImageGear v16\MD\ActiveX\Samples\Delphi2007\Package</AccuSoftPackageDir>				<VCLZip_Pro Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\VCLZip_Pro</VCLZip_Pro>		<MSBuildInstallShieldDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\MSBuild\InstallShield\2012Spring</MSBuildInstallShieldDir>		<InstallShieldPath Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\InstallShield\2012Spring\System</InstallShieldPath>				<NetworkBuildDir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">\\W2k8-stvi-sqa\Release\ReadyToTest\Patch$(PatchNumber)</NetworkBuildDir>		<MS_SDK_Dir Condition="'$(COMPUTERNAME)'=='isw-imgxpvmbld4'">C:\Program Files\Microsoft SDKs\Windows\v7.0A</MS_SDK_Dir>			<!-- ================================================= -->									<!-- Specfic defined parameters for Build-5 server -->						<BDK32Dir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\Vista\BDK32</BDK32Dir>					<DelphiDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\CodeGear\RAD Studio\5.0</DelphiDir>		<DelphiVA508Dir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\CodeGear\RAD Studio\5.0\Imports\VA508Access</DelphiVA508Dir>				<DelphiFilmanexDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Users\Public\Documents\RAD Studio\5.0\Demos\DelphiWin32\VCLWin32\Doc\Filmanex</DelphiFilmanexDir>			<AccuSoftDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\AccuSoft\ImageGear v16</AccuSoftDir>		<AccuSoftPackageDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\AccuSoft\ImageGear v16\MD\ActiveX\Samples\Delphi2007\Package</AccuSoftPackageDir>				<VCLZip_Pro Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">E:\BuildLib\VCLZip_Pro_4.60</VCLZip_Pro>		<!-- VCLZip_Pro Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\VCLZip_Pro</VCLZip_Pro -->				<MSBuildInstallShieldDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\MSBuild\InstallShield\2012Spring</MSBuildInstallShieldDir>		<InstallShieldPath Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\InstallShield\2012Spring\System</InstallShieldPath>		<NetworkBuildDir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">\\vaausvimapp804.aac.dva.va.gov\CM\ReadyToTest\Patch$(PatchNumber)</NetworkBuildDir>		<MS_SDK_Dir Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A</MS_SDK_Dir>					<MSBuildExtensionsPath Condition="'$(COMPUTERNAME)'=='VAAUSVIMAPP872'">$(MSBuildExtensionsPath64)</MSBuildExtensionsPath>			<!-- ================================================= -->				<NonVisaCfgDir>$(CodeBaseDir)\IMAG_Build\Configuration\NonVisaConfig</NonVisaCfgDir>		<ClinicalDir>$(CodeBaseDir)\IMAG_Source\Clinical</ClinicalDir>				<ReleaseClinDir>$(CodeBaseDir)\IMAG_Build\Release\Clin</ReleaseClinDir>				<ExeFileName>MAG3_0P$(PatchNumber)T$(TestNumber)_Clinical_Capture_Setup.exe</ExeFileName>		<MsiFileName>MAG3_0P$(PatchNumber)T$(TestNumber)_Clinical_Capture_Install.msi</MsiFileName>				<InstallShieldProject>$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Build\Capture\MagCaptureInstall.ism</InstallShieldProject>			<ProductVersion Condition="'$(ProductVersionInclude)'!='false'">30.$(SequenceNumber).$(PatchNumber).$(TestNumber)</ProductVersion>				<ToolsDir>$(CodeBaseDir)\IMAG_Build\Tools</ToolsDir>		<BaseReleaseDir>$(CodeBaseDir)\IMAG_Build\Release\Clin</BaseReleaseDir>				<GWHomeDir>$(CodeBaseDir)\IMAG_Build\LegacyVSS\GW</GWHomeDir>		<P106LibAccusoftHome>$(GWHomeDir)\3rd Party Source\Accusoft\Accusoft16.2</P106LibAccusoftHome>		<P72LibHome>$(GWHomeDir)\3rd Party Source\Accusoft\Accusoft15</P72LibHome>		</PropertyGroup>	<!-- ==============================================================================  -->	<ItemGroup>		<ResVerEditorDirectory Include="$(ToolsDir)\ResVerEditor" />		<P72Lib Include="$(P72LibHome)\**\*.*" />		<P106LibAccusoft Include="$(P106LibAccusoftHome)\**\*.*" />		<ReleaseToCopy Include="$(BaseReleaseDir)\**\*.*" />			</ItemGroup>		<!-- ============================================================================  -->		<Import Project="$(MSBuildInstallShieldDir)\InstallShield.targets" />		<Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>	<Import Project="$(MSBuildExtensionsPath)\ExtensionPack\4.0\MSBuild.ExtensionPack.tasks" /> 	<Import Project="$(NonVisaCfgDir)\Common\build.VistAImaging.xml"/>			<Import Project="$(ClinicalDir)\Delphi\Applications\Build\Capture\build.Capture.prop"/>		<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Delete previous build -->	<Target Name="CleanPreviousBuild" >		<RemoveDir Directories="$(FullBuildPath)" Condition="Exists('$(FullBuildPath)')" />		<RemoveDir Directories="$(ReleaseDir)" Condition="Exists('$(ReleaseDir)')" /> 		</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Create build ouput directories -->	<Target Name="CreateDirectories" DependsOnTargets="CleanPreviousBuild" >		<MakeDir directories="$(FullBuildPath)$(TempFolder)" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)\P106Lib\System" />				<MakeDir directories="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Clin\dcu\Components" />						</Target>	<!-- =============================================================================== -->	<!-- =============================================================================== -->		<!-- Copy files from source control over to build output directory -->	<Target Name="CopyFiles"  DependsOnTargets="CreateDirectories" >				<Copy SourceFiles="@(ReleaseToCopy)" DestinationFiles="@(ReleaseToCopy->'$(ReleaseDir)\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(P106LibAccusoft)" DestinationFiles="@(P106LibAccusoft->'$(FullBuildPath)$(TempFolder)\P106Lib\LIB\Accusoft16.2\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(P72Lib)" DestinationFiles="@(P72Lib->'$(FullBuildPath)$(TempFolder)\P72 Lib\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(P106LibSystem)" DestinationFiles="@(P106LibSystem->'$(FullBuildPath)$(TempFolder)\P106Lib\System\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(PatchDepName)" DestinationFiles="@(PatchDepName->'$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\%(RecursiveDir)%(Filename)%(Extension)')" />		<Copy SourceFiles="@(Accusoft)" DestinationFiles="@(Accusoft->'$(FullBuildPath)$(TempFolder)\P106Lib\Lib\Accusoft16.2\%(RecursiveDir)%(Filename)%(Extension)')" />		</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="UpdateVersion" DependsOnTargets="CopyFiles" Outputs="%(CompileFiles.Filename)">		<PropertyGroup>				<ResDir>%(ResVerEditorDirectory.FullPath)</ResDir>		</PropertyGroup>					<message text="Updating File Version number for %(CompileFiles.Filename).res" Importance="High"/>		<Exec Command='"$(ResDir)\ResVerEditor.exe" -u %(CompileFiles.Filename).res $(ProductVersion)' WorkingDirectory="%(CompileFiles.RelativeDir)" Condition="'%(CompileFiles.UpdateVersion)'!='false'" ContinueOnError="false" />		</Target>	<!-- =============================================================================== -->	<!-- =============================================================================== -->				<!-- Compile Delphi projects -->	<Target Name="Compile" DependsOnTargets="UpdateVersion" Outputs="%(CompileFiles.Filename)">		<message text="Compiling %(CompileFiles.Filename)%(CompileFiles.Extension) with compiler %(CompileFiles.Compiler)" Importance="High"/>		<MSBuild Projects="%(CompileFiles.Identity)" Targets="%(CompileFiles.Options)" Properties="Configuration=%(CompileFiles.Configuration)" Condition="'%(CompileFiles.Compiler)'=='MSBuild'AND '%(CompileFiles.ProjectOverride)'!='true'" /> 		<MSBuild Projects="%(CompileFiles.Identity)"			Condition="'%(CompileFiles.Compiler)'=='MSBuild' AND '%(CompileFiles.ProjectOverride)'=='true'"			Targets="%(CompileFiles.Options)" 			Properties="Configuration=%(CompileFiles.Configuration);						DCC_DcuOutput=%(CompileFiles.DCC_DcuOutput);						DCC_ObjOutput=%(CompileFiles.DCC_ObjOutput);						DCC_HppOutput=%(CompileFiles.DCC_HppOutput);						DCC_UnitSearchPath=%(CompileFiles.DCC_UnitSearchPath);						DCC_ResourcePath=%(CompileFiles.DCC_ResourcePath);						DCC_ObjPath=%(CompileFiles.DCC_ObjPath);						DCC_IncludePath=%(CompileFiles.DCC_IncludePath);						DCC_Define=%(CompileFiles.DCC_Define)"		/> 											<message text="Performing code signing of %(CompileFiles.Filename).%(CompileFiles.Sign)" />		<Exec Command='"$(MS_SDK_Dir)\bin\signtool.exe"  sign /a %(CompileFiles.Filename).%(CompileFiles.Sign)' WorkingDirectory="%(CompileFiles.RelativeDir)" ContinueOnError="true" />			</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->	<!-- Generate Product and Package code for InstallShield -->	<Target Name="UpdateISM" DependsOnTargets="Compile" >		<CallTarget Targets="GenerateProductCode" />	<!-- from ...\Common\buil.VistAImaging.xml -->		<CallTarget Targets="GeneratePackageCode" />	<!-- from ...\Common\buil.VistAImaging.xml -->	</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->			<!-- Copy artifacts to release folder -->	<Target Name="Copy_Artifacts" DependsOnTargets="UpdateISM" >		<ItemGroup>			<BMPFiles Include="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\BMP\**\*.*" />			<HelpFiles Include="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Help\**\*.*"/>					</ItemGroup>				<Copy SourceFiles="@(BMPFiles)" DestinationFolder="$(ReleaseDir)\BMP" />		<Copy SourceFiles="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Capture\MagCaptureMain.exe" DestinationFiles="$(ReleaseDir)\MagImageCapture.exe" />			<Copy SourceFiles="@(HelpFiles)" DestinationFiles="@(HelpFiles->'$(ReleaseDir)\help\%(RecursiveDir)%(Filename)%(Extension)')" ContinueOnError="false"/>			</Target>		<!-- =============================================================================== -->	<!-- =============================================================================== -->	<!-- Create exe and/or msi file -->	<Target Name="BuildRelease" DependsOnTargets="Copy_Artifacts" >		<CallTarget Targets="CreateInstaller" />	<!-- from ...\Common\buil.VistAImaging.xml -->	</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="StageToSQA" >			<MakeDir Directories="$(NetworkBuildDir)" Condition="!Exists('$(NetworkBuildDir)')" />		<Delete Files="$(NetworkBuildDir)\$(ExeFileName)" Condition="!Exists('$(NetworkBuildDir)\$(ExeFileName)')" />		<Delete Files="$(NetworkBuildDir)\$(MsiFileName)" Condition="!Exists('$(NetworkBuildDir)\$(MsiFileName)')" />		<Copy SourceFiles="$(FullBuildPath)\$(ExeFileName)" Destinationfolder="$(NetworkBuildDir)"/>		<Copy SourceFiles="$(FullBuildPath)\$(MsiFileName)" Destinationfolder="$(NetworkBuildDir)"/>		</Target>			<!-- =============================================================================== -->	<!-- =============================================================================== -->		<Target Name="Publish" DependsOnTargets="BuildRelease" >		<ItemGroup>			<BuildArtifacts Include="$(FullBuildPath)\*.*" />		</ItemGroup>				<Copy SourceFiles="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Build\Capture\Express\MagInstall-exe\DiskImages\DISK1\setup.exe" DestinationFiles="$(FullBuildPath)\$(ExeFileName)" Condition="'$(CreateExe)'!='False'"/>			<Copy SourceFiles="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Build\Capture\Express\MagInstall-msi\DiskImages\DISK1\VistA Imaging Clinical Capture.msi" DestinationFiles="$(FullBuildPath)\$(MsiFileName)" Condition="'$(CreateMsi)'!='False'"/>				<CallTarget Targets="StageToSQA"  Condition="'$(StageToSQA)'=='True'" />    </Target>            <!-- =============================================================================== -->	<!-- =============================================================================== -->	<Target Name="TEST" >				<Message text="DEBUGING DEBUGING DEBUGING ..." /> 		<CallTarget Targets="CreateDirectories" />	</Target>	</Project>