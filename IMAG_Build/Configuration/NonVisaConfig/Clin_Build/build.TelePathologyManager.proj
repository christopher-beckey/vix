<?xml version="1.0" encoding="utf-8"?><Project ToolsVersion="4.0" DefaultTargets="Publish" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">	<Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>	<Import Project="C:\Program Files\MSBuild\ExtensionPack\4.0\MSBuild.ExtensionPack.tasks"/> 	<PropertyGroup>		<PatchName>Version 3.0 Patch 138 - Telepathology Worklist</PatchName>		<PatchNumber>138</PatchNumber>		<ConfigurationDir>..\..\..\</ConfigurationDir>				<SourceDir>$(CCSnapshotDir)\Main\Source\Production\Clinical\DotNet\Telepathology</SourceDir>		<TF>"C:\Program Files\Microsoft Visual Studio 10.0\Common7\IDE\tf.exe"</TF>			<TFSVistaSourceLocation>$/VistA_Imaging/Dev/Patch$(PatchNumber)/</TFSVistaSourceLocation>			<NetworkBuildDir>\\vhaiswclu4\common$\builds</NetworkBuildDir>				<TFSDir>E:\TFS1\VistA_Imaging</TFSDir>				<DiffUtilDir>C:\Program Files\GnuWin32\bin</DiffUtilDir>			<CCSnapshotDir>E:\CC1\IMAG_bld</CCSnapshotDir>		<DiffReportName>MAG3_0P$(PatchNumber)T$(TestNumber)Bld$(BuildNumber)TelePathManager_Diff_Rpt.txt</DiffReportName>			</PropertyGroup>	<Import Project="$(SourceDir)\build.TelepathologyManager.prop"/>	<Import Project="C:\Program Files\MSBuild\InstallShield\2012Spring\InstallShield.targets" />	<Import Project="$(ConfigurationDir)\Builds\build.VistAImaging.targets"/>	 	<Target Name="UpdateTFS" >			<Exec Command="$(TF) get $(TFSSourceDir)/Production/Clinical/DotNet/Telepathology /recursive /version:T /noprompt /login:harris-hc-lab\$(TFSusername),$(TFSPassword)" WorkingDirectory="$(TFSDir)" Condition="'$(UpdateTFS)'!='false'" />		</Target>	 	<Target Name="UpdateClearCase" DependsOnTargets="UpdateTFS" >		<Exec Command='"ClearTool.exe" update -force $(CCSnapshotDir)\$(BranchName)\Source\Production\Clinical\DotNet\Telepathology' Condition="'$(UpdateClearCase)'!='false'"  ContinueOnError="false" />	</Target>	<Import Project="$(SourceDir)\build.TelepathologyManager.prop"/>		<!-- =============== Delete previous build (if build folder exists) ================== -->	<Target Name="CleanPreviousBuild" DependsOnTargets="UpdateClearCase" >		<RemoveDir Directories="$(FullBuildPath)" />		</Target>			<!-- =============== Create build ouput directories ================================== -->	<Target Name="CreateDirectories" DependsOnTargets="CleanPreviousBuild" >		<MakeDir directories="$(RootDir)" />		<MakeDir directories="$(RootDir)$(ProjectName)" />		<MakeDir directories="$(FullBuildPath)$(TempFolder)" />	</Target>	<!-- ======  Compare TFS and CC code and write to a text file which files differ ===== --> 	<Target Name="TFS_CC_Diff" DependsOnTargets="CreateDirectories" >			<WriteLinesToFile File="$(FullBuildPath)\$(DiffReportName)" Lines="Comparing ClearCase against TFS for the following folders and subfolders-> Dev\Patch$(PatchNumber)\Source\Production\Clinical\DotNet\Telepathology" />		<WriteLinesToFile File="$(FullBuildPath)\$(DiffReportName)" Lines="If there are no files listed there are no differences" Overwrite="false" />		<WriteLinesToFile File="$(FullBuildPath)\$(DiffReportName)" Lines="===================================================================================================================================" Overwrite="false" />		<Exec Command='"$(DiffUtilDir)\diff.exe" -i -w -r -q $(TFSWorkspaceSourceDir)\Production\Clinical\DotNet\Telepathology $(CCSnapshotDir)\$(BranchName)\Source\Production\Clinical\DotNet\Telepathology >> "$(FullBuildPath)\$(DiffReportName)"' IgnoreExitCode="true" Condition="'$(TFSCCDiff)'!='false'" />	</Target>				<!-- ================== Copy files from source control over to build output directory ====================================================== -->	<Target Name="CopyFiles"  DependsOnTargets="TFS_CC_Diff" >		<Copy SourceFiles="@(PatchDepName)" DestinationFiles="@(PatchDepName->'$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\%(RecursiveDir)%(Filename)%(Extension)')" />	</Target>		<Target Name="UpdateAssembly" DependsOnTargets="CopyFiles" >		<PropertyGroup>			<Major>3</Major>			<Minor>0</Minor>			<Build>$(PatchNumber)</Build>			<Revision>$(TestNumber)</Revision>		</PropertyGroup>		<MSBuild.ExtensionPack.Framework.AssemblyInfo 			Condition="'%(CSProjects.ExcludeFileVersion)'!='true'"			AssemblyInfoFiles="%(CSProjects.RelativeDir)\Properties\AssemblyInfo.cs"			AssemblyVersion="$(Major).$(Minor).$(Build).$(Revision)"			AssemblyFileVersion="$(Major).$(Minor).$(Build).$(Revision)"	>        </MSBuild.ExtensionPack.Framework.AssemblyInfo>	</Target>	<!-- ================== Compile Delphi projects ================================================== -->	<Target Name="Compile" DependsOnTargets="UpdateAssembly" ><!--		<MSBuild Projects="%(CSProjects.Identity)" Properties="Configuration=$(Configuration);SolutionDir=$(SolutionDir)"  /> -->		<MSBuild Projects="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Telepathology.sln" Properties="Configuration=$(Configuration);Platform=x86"  /> 	</Target>		<!-- ===============Generate Product and Package code for InstallShield ========================== -->	<Target Name="UpdateISM" DependsOnTargets="Compile" >		<CallTarget Targets="GenerateProductCode" />		<CallTarget Targets="GeneratePackageCode" />	</Target>			<!-- ================== Copy artifacts to release folder  ====================================================== -->	<Target Name="Copy_Artifacts" DependsOnTargets="UpdateISM" >		<ItemGroup>			<Artifacts Include="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\GalaSoft.MvvmLight.Extras.WPF4.dll; 				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\CCOWRPCBroker.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Bapi32_47_1.dll;							$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Aga.Controls.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\log4net.dll;								$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\GalaSoft.MvvmLight.Extras.WPF4.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\GalaSoft.MvvmLight.WPF4.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Microsoft.Practices.ServiceLocation.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Microsoft.Practices.Unity.Configuration.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\Microsoft.Practices.Unity.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\RestSharp.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VergenceContextor.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VergenceContextor.sxs.manifest;								$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\System.Windows.Interactivity.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Broker.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.CCOW.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Common.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Communication.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\VistA.Imaging.Telepathology.Logging.dll;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\MagTPWorklist.exe;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\MagTPWorklist.exe.config;				$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\**\bin\**\$(Configuration)\WPFToolkit.Extended.dll" />		</ItemGroup>		<Copy SourceFiles="@(Artifacts)" DestinationFolder="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\Artifacts" ContinueOnError="false" />		</Target>				<!-- ================== Create exe and/or msi file  ====================================================== -->	<Target Name="BuildRelease" DependsOnTargets="Copy_Artifacts"  >		<CallTarget Targets="CreateInstaller" />	</Target>			<Target Name="Publish" DependsOnTargets="BuildRelease" Condition="'$(BuildTelePathologyManager)'!='false'"  >		<Copy SourceFiles="$(FullBuildPath)$(TempFolder)\p$(PatchNumber)\MagTelePathologyManager\PROJECT_ASSISTANT\SINGLE_EXE_IMAGE\DiskImages\DISK1\setup.exe" DestinationFiles="$(FullBuildPath)\MAG3_0P$(PatchNumber)T$(TestNumber)_$(ReleaseName)Setup.exe" Condition="'$(CreateExe)'!='false'" ContinueOnError="True"/>			<ItemGroup>			<BuildArtifacts Include="$(FullBuildPath)\*.*" />		</ItemGroup>				<Copy SourceFiles="@(BuildArtifacts)" Destinationfolder="$(NetworkBuildDir)\V$(Version)p$(PatchNumber)Build$(BuildNumber)_T$(TestNumber)"/>		<RemoveDir Directories="$(FullBuildPath)$(TempFolder)" Condition="'$(TempDelete)'=='true'" ContinueOnError="true"/>    </Target></Project>