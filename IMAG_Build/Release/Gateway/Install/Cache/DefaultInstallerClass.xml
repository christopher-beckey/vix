<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Class name="Sample.Installer">
<Description>
Sample Installer</Description>
<IncludeCode>%occInclude</IncludeCode>
<TimeCreated>61494,40487</TimeCreated>

<XData name="MyApp">
<Description>
Application Definition</Description>
<XMLNamespace>INSTALLER</XMLNamespace>
<Data><![CDATA[
<Manifest>

<!-- Create the namespace, yes it's Ensemble enabled for MyApp -->
<Namespace Name="DICOM"
          Create="yes"
          Code="DICOM"
          Data="DICOM"
		  >
<Configuration>

<!-- Create a "data" database -->
<Database 
  Name="DICOM" 
  Dir="C:\DICOM\Cache" 
  Create="yes"
  />

<!-- MyApp mappings back to the MYAPP DB.-->
<GlobalMapping Global="%ZOSF" From="DICOM"/>
<GlobalMapping Global="TMP" From="CACHETEMP"/>
<RoutineMapping Routines="%DT*" Type="ALL" From="DICOM"/>

</Configuration>

<Invoke Class="%SYSTEM.OBJ" Method="Upgrade" CheckStatus="true"/>

</Namespace>

<Namespace Name="%SYS" Create="no">

<Invoke Class="Config.Namespaces" Method="ActivateOne" CheckStatus="true">
<Arg Value="DICOM"/>
</Invoke>

<Invoke Class="Sample.Installer" Method="ModServices"/>

<Import File="C:/CacheDist/mag_zstu.rtn"/>

<Invoke Class="Security.Users" Method="Import" CheckStatus="true">
<Arg Value="C:\CacheDist\UnknownUser.xml"/>
</Invoke>

</Namespace>

<Namespace Name="DICOM" Create="no">

<!-- Load patch classes (if they exist) -->
<If Condition='#{##class(%File).DirectoryExists("C:/CacheDist/Install/")}'>
<!-- Load a directory full of files, ignore error 5202 ... -->
<Import File="C:/CacheDist/Install/" IgnoreErrors="5202" Flags="ck"/>
</If>

<Import File="C:/CacheDist/Install/mag_global.gof" IgnoreErrors="0" Flags="ck"/>

</Namespace>

<Namespace Name="%SYS" Create="no">
<Invoke Class="Sample.Installer" Method="SetMaxSizeCACHETEMP"/>
</Namespace>

<Namespace Name="%SYS" Create="no">
<Invoke Class="Sample.Installer" Method="NotifyIntersys"/>
</Namespace>

</Manifest>
]]></Data>
</XData>

<Method name="setup">
<Description>
This is a method generator whose code is generated by XGL.</Description>
<Internal>1</Internal>
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[&pVars,pLogLevel:%Integer,pInstaller:%Installer.Installer]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#; Let our XGL document generate code for this method. 
	Quit ##class(%Installer.Manifest).%Generate(%compiledclass, %code, "MyApp")
]]></Implementation>
</Method>

<Method name="ModServices">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	Set tProperties("Enabled")=1
	d ##class(Security.Services).Modify("%Service_Telnet",.tProperties)
]]></Implementation>
</Method>

<Method name="NotifyIntersys">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	Set file = "C:\Cachesys\Mgr\old5.key"
	ZN "DICOM"
	Q:$$ISIHS^MAGSPID()  ; Do not send an e-mail notification if this is IHS site
	Set status = $$OPEN^MAGOSFIL(file,"R")
	Q:+status<0
	Set status = $$USE^MAGOSFIL(file)
	Q:+status<0
	Set result = "",flag=0
	For  Do  Quit:flag=1
 	. Set status = $$READ^MAGOSFIL(file,.line,5)
 	. If +(status) < 0 s flag=1
 	. Set result = result_$C(13,10)_"  "_line
 	. Quit
 	Set status = $$CLOSE^MAGOSFIL(file)
	Set status = $$NOTIFY^MAGDMMSN(result)
]]></Implementation>
</Method>

  <Method name="SetMaxSizeCACHETEMP">
    <ClassMethod>1</ClassMethod>
    <Implementation>
      <![CDATA[	
  Set db=##Class(SYS.Database).%OpenId("C:\CACHESYS\MGR\CACHETEMP\")
  Set db.MaxSize=500
  Set status=db.%Save()
]]>
    </Implementation>
  </Method>
</Class>
</Export>
